# Python Scripts for Digit

This folder contains multiple python scripts related to gait optimization for Digit.
Note that you need to be inside the current folder (`RAPTOR/Examples/Digit/python`) to run these scripts because of the path defined in these scripts.

## visualize_trajectory.py

### Overview
The `visualize_trajectory.py` script visualizes the open-loop trajectory generated by **RAPTOR** in PyBullet by directly setting the joint angles.  
Note that there is no dynamics or control considered.
This tool is useful for visually inspecting trajectory feasibility for further refinement and tuning.

### Usage
The `visualize_trajectory.py` script loads a text file that stores the open-loop trajectory as a matrix, with the following format:

```math
\left[
\begin{array}{c}
q(t_1)^T, \dot{q}(t_1)^T, \ddot{q}(t_1)^T, \tau^T(t_1), \lambda^T(t_1)\\
q(t_2)^T, \dot{q}(t_2)^T, \ddot{q}(t_2)^T, \tau^T(t_2), \lambda^T(t_2)\\
\vdots\\
q(t_N)^T, \dot{q}(t_N)^T, \ddot{q}(t_N)^T, \tau^T(t_N), \lambda^T(t_N)
\end{array}
\right]
```

In this instance, the data matrix has `N` columns, which is equal to the number of time instances specified in the optimization problem (for example, variable `N` defined in line 46 of `DigitSingleStep.cpp`, or `N` loaded from the yaml file).
The first 36 entries of each row of the matrix represents the joint positions at the corresponding time instance along the trajectory (since the Digit model in this example has 36 joints in total).

Line 217-249 of `DigitSingleStep.cpp` provides the code as an example to generate such data matrix after solving the optimization problem, so that `visualize_trajectory.py` can parse and visualize the optimal trajectory.
You can change the filename or the path of this data matrix.

## digit_simulation.py

### Overview
The `digit_simulation.py` script is designed to simulate the dynamics of the Digit robot using the embedded function in [pinocchio](https://github.com/stack-of-tasks/pinocchio/). 
It integrates the dynamics of a constrained system, applying both open-loop and feedback (PD) control to track a desired trajectory. 
The script also handles various closed-loop constraints and contact models for the Digit robot.

In terms of forward simulating a system with constraints, this script is extended from one [official example](https://github.com/stack-of-tasks/pinocchio/blob/master/examples/simulation-closed-kinematic-chains.py) from pinocchio.
Readers should refer to [1] for more theoretical information.

<!-- ### Usage
Similarly to `visualize_trajectory.py`, `digit_simulation.py` also requires an data matrix that stores the  -->

## export_pybullet_info_for_blender.py
This script is helpful to generate blender animation for Digit.
It uses PyBullet as forward kinematics helper to retrive the positions and orientations of each mesh file (for each link) following a sequence of joint positions (a trajectory, in other words).

Readers should refer to [this repo](https://github.com/huy-ha/pybullet-blender-recorder) for a more general introduction.
There will not be any further documentation  for this script.

## References

[1] J. Carpentier, M. Louis and LL. Quentin. “From Compliant to Rigid Contact Simulation: a Unified and Efficient Approach.” 2024 Robotics: Science and Systems (RSS), Netherlands.